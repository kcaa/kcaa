<meta charset="utf-8">
<polymer-element name="kcaa-assistant">
  <template>
    <!-- ================================================================== -->
    <!-- Ship list -->
    <!-- TODO: Is it possible to separate this template to shiplist.html? -->
    <!--       Seems like <link rel="import"> doesn't work with templates. -->
    <!-- ================================================================== -->
    <template id="shiplist">
      <!-- TODO: How to customize columns? Sometimes I want to see other
           parameters like cruising speed, anti-submarine or the like. -->
      <table class="{{defaultClass}}">
        <col>
        <col width="60px">
        <col width="50px">
        <col width="50px">
        <col width="50px">
        <col width="50px">
        <col width="50px">
        <col width="50px">
        <col width="50px">
        <col width="50px">
        <thead>
          <tr>
            <th>名前</th>
            <th>レベル</th>
            <th>燃料</th>
            <th>弾薬</th>
            <th>戦意</th>
            <th>HP</th>
            <th>火力</th>
            <th>雷装</th>
            <th>対空</th>
            <th>装甲</th>
          </tr>
        </thead>
        <tbody>
          <tr template repeat="{{ship in ships}}"
              class="{{ship.stateClass}}">
            <td>
              <div class="title {{ship.lockedClass}}">{{ship.name}}</div>
              <div>{{ship.shipType}}</div>
              <template if="{{ships.length > 6 &&
                              ship.belongingFleet != null}}">
                <div>
                  第{{ship.belongingFleet.id}}艦隊所属
                  <template if="{{ship.belongingFleet.undertakingMission
                                  != null}}">
                    (遠征中)
                  </template>
                </div>
              </template>
            </td>
            <td class="numberColumn {{ship.levelClass}}">
              <div>{{ship.level}}<template
                if="{{ship.experienceGauge != null}}"><span
                class="subordinate">.{{ship.experienceGauge}}</span>
                </template></div>
              <template if="{{ship.upgradeLevel != 0}}">
                <div>改: {{ship.upgradeLevel}}</div>
              </template>
            </td>
            <td class="numberColumn">
              <div>{{ship.fuelPercentage}}%</div>
              <div>{{ship.fuel}}/{{ship.fuelCapacity}}</div>
            </td>
            <td class="numberColumn">
              <div>{{ship.ammoPercentage}}%</div>
              <div>{{ship.ammo}}/{{ship.ammoCapacity}}</div>
            </td>
            <td class="numberColumn">{{ship.vitality}}</td>
            <td class="numberColumn">
              <div>{{ship.hpPercentage}}%</div>
              <div>{{ship.hp}}/{{ship.maxHp}}</div>
            </td>
            <td class="numberColumn {{ship.firepowerClass}}">
              <div>{{ship.firepower}}</div>
              <div>{{ship.enhancedFirepower}}/{{ship.maxFirepower}}</div>
            </td>
            <td class="numberColumn {{ship.thunderstrokeClass}}">
              <div>{{ship.thunderstroke}}</div>
              <div>
                {{ship.enhancedThunderstroke}}/{{ship.maxThunderstroke}}
              </div>
            </td>
            <td class="numberColumn {{ship.antiAirClass}}">
              <div>{{ship.antiAir}}</div>
              <div>{{ship.enhancedAntiAir}}/{{ship.maxAntiAir}}</div>
            </td>
            <td class="numberColumn {{ship.armorClass}}">
              <div>{{ship.armor}}</div>
              <div>{{ship.enhancedArmor}}/{{ship.maxArmor}}</div>
            </td>
          </tr>
        </tbody>
      </table>
    </template>

    <link rel="stylesheet" href="kcaa.css">
    <link rel="stylesheet" href="assistant.css">
    <link rel="stylesheet" href="shiplist.css">
    <div id="assistant">
      <div class="row twoColumn">
        <div class="column">
          <div class="board">
            <h3>ステータス</h3>
            <h4>クライアントの状態</h4>
            <div>
              <div>現在の画面: {{model.screen}}</div>
              <div>自動操作中:
                <template if="{{model.runningManipulator == null}}">
                  なし
                </template>
                <template if="{{model.runningManipulator != null}}">
                  {{model.runningManipulator}}
                  <template if="{{model.manipulatorsInQueue.length > 0}}">
                    (+{{model.manipulatorsInQueue.length}})
                  </template>
                </template>
              </div>
              <div>操作補助:
                <template if="{{model.preferences.automanPrefs.enabled}}">
                  有効
                </template>
                <template if="{{!model.preferences.automanPrefs.enabled}}">
                  無効
                </template>
                <template if="{{model.autoManipulatorsActive}}">
                  (アクティブ)
                </template>
                <template if="{{!model.autoManipulatorsActive}}">
                  (非アクティブ)
                </template>
                <button on-click="{{showModalDialog}}"
                        data-dialog="kcaaScheduleDialog">設定</button>
              </div>
            </div>
          </div>
        </div>
        <div class="column">
          <div class="board commandBoard">
            <h3>クイックコマンド</h3>
          </div>
        </div>
      </div>
      <div id="screenSection" class="row horizontal hidden">
        <div class="board">
          <h3 data-collapsed="false">画面</h3>
          <div>
            <button on-click="{{toggleUpdateScreenPeriodically}}">
              自動更新<template
                if="{{updateScreenPeriodically}}">停止</template><template
                if="{{!updateScreenPeriodically}}">開始</template>
            </button>
          </div>
          <div class="screenContainer">
            <svg id="clickMarker" width="128" height="128">
              <circle cx="64" cy="64" r="61" stroke="#ffffff"
                      stroke-width="6px" fill="none"></circle>
              <circle cx="64" cy="64" r="61" stroke="#003f7f"
                      stroke-width="3px" fill="none"></circle>
              <circle cx="64" cy="64" r="10" stroke="none" fill="#003f7f"
                      fill-opacity="0.7"></circle>
              <circle cx="64" cy="64" r="7" stroke="none" fill="#ffffff"
                      fill-opacity="0.9"></circle>
            </svg>
            <img id="screenshot"
                 on-click="{{clickScreen}}" on-load="{{updateScreen}}">
          </div>
        </div>
      </div>
      <div class="row horizontal">
        <div class="board">
          <h3 data-collapsed="false">艦隊</h3>
          <template repeat="{{fleet in model.fleets}}">
            <section>
              <h4 data-collapsed="{{fleet.collapsed}}">
                第{{fleet.id}}艦隊: {{fleet.name}}
                <template if="{{fleet.undertakingMission != null}}">
                  (遠征中: {{fleet.undertakingMission}},
                   帰還: {{fleet.missionEtaDatetimeString}})
                </template>
                <template if="{{fleet.id > 1 &&
                                fleet.undertakingMission == null}}">
                  <button on-click="{{showModalDialog}}"
                          data-dialog="kcaaFleetMissionDialog"
                          data-fleet-id="{{fleet.id}}">遠征選択</button>
                </template>
                <button class="collapse"
                        on-click="{{toggleCollapseFleet}}"
                        data-fleet-id="{{fleet.id}}"></button>
              </h4>
              <template ref="shiplist" bind="{{fleet}}"></template>
            </section>
          </template>
        </div>
      </div>
      <div class="row horizontal">
        <div class="board">
          <h3 data-collapsed="true">艦船 ({{model.ships.length}}隻)</h3>
          <div>
            <template ref="shiplist" bind="{{model}}"></template>
          </div>
        </div>
      </div>
      <div class="row horizontal">
        <div class="board">
          <h3 data-collapsed="true">
            入渠 ({{model.numShipsBeingRepaired}}/{{
              model.repairSlots.length}}隻)
          </h3>
          <table>
            <col>
            <col width="50px">
            <col width="100px">
            <thead>
              <tr>
                <th>艦船</th>
                <th>HP</th>
                <th>修理完了</th>
              </tr>
            </thead>
            <tbody>
              <tr template repeat="{{slot in model.repairSlots}}"
                  class="{{slot.ship.stateClass}}">
                <td>
                  <!-- TODO: Remove this workaround (extract the first div out
                             of template). Probably can be removed when
                             switching to div-based styling. -->
                  <div>
                    <template if="{{slot.ship != null}}">
                      <div class="title {{slot.ship.lockedClass}}">
                        {{slot.ship.name}}
                      </div>
                    </template>
                    <template if="{{slot.ship == null}}">空き</template>
                  </div>
                  <div>{{slot.ship.shipType}}</div>
                  <template if="{{slot.ship.belongingFleet != null}}">
                    <div>
                      第{{slot.ship.belongingFleet.id}}艦隊所属
                    </div>
                  </template>
                </td>
                <td class="numberColumn">
                  <div>
                    <template if="{{slot.ship != null}}">
                      <div>{{slot.ship.hpPercentage}}%</div>
                    </template>
                  </div>
                  <template if="{{slot.ship != null}}">
                    <div>{{slot.ship.hp}}/{{slot.ship.maxHp}}</div>
                  </template>
                </td>
                <td>{{slot.etaDatetimeString}}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="row horizontal">
        <div class="board">
          <h3 data-collapsed="true">
            任務一覧 ({{model.numQuestsUndertaken}}/5個遂行中)
          </h3>
          <table>
            <col width="50px">
            <col>
            <col width="50px">
            <col width="50px">
            <col width="50px">
            <col width="50px">
            <col width="50px">
            <thead>
              <tr>
                <th>種別</th>
                <th>説明</th>
                <th>燃料</th>
                <th>弾薬</th>
                <th>鋼材</th>
                <th>ボーキ</th>
                <th>進捗</th>
              </tr>
            </thead>
            <tbody>
              <tr template repeat="{{quest in model.quests}}"
                  class="{{quest.stateClass}}">
                <td class="labelColumn">
                  <div>{{quest.category}}</div>
                  <div>{{quest.cycle}}</div>
                </td>
                <td>
                  <div class="title">{{quest.name}}</div>
                  <div>{{quest.description}}</div>
                </td>
                <td>{{quest.fuel}}</td>
                <td>{{quest.ammo}}</td>
                <td>{{quest.steel}}</td>
                <td>{{quest.bauxite}}</td>
                <td>
                  <template if="{{quest.state != 3}}">
                    {{quest.progress}}%
                  </template>
                  <template if="{{quest.state == 3}}">
                    達成!
                  </template>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="row horizontal">
        <div class="board">
          <h3 data-collapsed="true">遠征一覧 ({{model.missions.length}}個)</h3>
          <table>
            <col width="70px">
            <col>
            <col width="50px">
            <col width="50px">
            <col width="50px">
            <col width="100px">
            <thead>
              <tr>
                <th>海域</th>
                <th>説明</th>
                <th>燃料</th>
                <th>弾薬</th>
                <th>時間</th>
                <th>遂行艦隊</th>
              </tr>
            </thead>
            <tbody>
              <tr template repeat="{{mission in model.missions}}"
                  class="{{mission.stateClass}}">
                <td class="labelColumn">
                  <div>{{mission.maparea}}</div>
                  <div>{{mission.difficulty}}</div>
                </td>
                <td>
                  <div class="title">{{mission.name}}</div>
                  <div>{{mission.description}}</div>
                </td>
                <td>
                  {{mission.fuelConsumption}}%
                </td>
                <td>
                  {{mission.ammoConsumption}}%
                </td>
                <td>{{mission.time}}分</td>
                <td>
                  <!-- It's easier to enclose everything with <template>, but
                       that introduces difficulty in CSS styling with
                       "td > div:first-child". -->
                  <div>{{mission.undertakingFleetName}}</div>
                  <div>
                    <template if="{{mission.undertakingFleetId != -1}}">
                      第{{mission.undertakingFleetId}}艦隊
                    </template>
                  </div>
                  <div>
                    <template if="{{mission.etaDatetimeString != null}}">
                      帰還: {{mission.etaDatetimeString}}
                    </template>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div id="debugControlsSection" class="row horizontal hidden">
        <div class="board">
          <h3 data-collapsed="true">デバッグコントロール</h3>
          <h4>モジュールリロード</h4>
          <button on-click="{{reloadKCSAPIModules}}">KCSAPIハンドラ</button>
          <button on-click="{{reloadManipulatorModules}}">マニピュレータ</button>
          <h4>API出力</h4>
          <div>
            <template repeat="{{objectType in availableObjects}}">
              <button on-click="{{getObjectFromName}}">{{objectType}}</button>
            </template>
          </div>
        </div>
      </div>
      <div id="debugInfoSection" class="row horizontal hidden">
        <div class="board">
          <h3 data-collapsed="true">デバッグ情報</h3>
          <div class="debugInfo">{{debugInfo}}</div>
        </div>
      </div>
    </div>
  </template>
  <script type="application/dart" src="assistant.dart"></script>
</polymer-element>
